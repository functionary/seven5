<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Seven5: Install</title>
  <meta name="GENERATOR" content="Blackfriday Markdown Processor v1.1" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" type="text/css" href="css/base.css" />
</head>
<body>

<h1>Seven5: Install</h1>

<p><nav>
    <ul>
        <li><a href="index.html">Intro</a></li>
        <li><a href="install.html">Install</a></li>
        <li><a href="develop.html">Develop</a></li>
        <li><a href="pontificate.html">Pontificate</a></li>
    </ul>
</nav></p>

<blockquote>
<p>In preparation for <a href="http://blog.golang.org/2011/10/preview-of-go-version-1.html">Go1</a> we are setting up <em>Seven5</em> to build using the <a href="http://weekly.golang.org/cmd/go/">go</a> command line tool.  This tool is not fully ready, but there is a workaround that is sufficient for us to use it.  See the discussion below about GOPATH and goinstall for more on this.</p>
</blockquote>

<p>Here are the commands which we run to install the <a href="https://github.com/seven5/seven5">Seven5 source</a> and prerequisites on our OS X boxen.  These install instructions expect you to be on <em>at least</em> the go weekly build of Jan 15 2012 (&ldquo;weekly.2012-01-15 11253&rdquo;).</p>

<p>You may need to edit the paths or config options to reflect your environment, but we made notes where that is likely.</p>

<h2>Go</h2>

<p>If you lack a compiler or something else Go needs, consult the <a href="http://golang.org/doc/install.html">Go install page</a>.</p>

<pre><code>mkdir ~/Documents/Go/ # Anywhere which you own is fine
cd ~/Documents/Go/
hg clone https://go.googlecode.com/hg/ go
cd go
hg update weekly #gives you most recent weekly build of go
cd src
./all.bash
./sudo.bash
</code></pre>

<p>To update to a new weekly:</p>

<pre><code>cd ~/Documents/Go/go/
hg pull
hg update weekly
cd src
./all.bash
./sudo.bash
</code></pre>

<h2>Your shell</h2>

<p>Some variables need to be in your environment before you proceed, so add them to ~/.bash_profile:</p>

<pre><code>export GOROOT=~/Documents/Go/go   #directory where you installed go
export GOBIN=$GOROOT/bin
export GOOS=darwin  #or your os, like 'linux' or 'freebsd'
export GOARCH=amd64  #or your arch, like 'x86' for 32-bit or 'arm'
export GOPATH=~/Documents/gothirdparty
export PATH=$PATH:$GOBIN:$GOPATH/bin
</code></pre>

<h2>GOPATH</h2>

<p>The recommended way (&ldquo;the one true way&rdquo;) is to use GOPATH to keep from polluting your Go installation (at GOROOT).  You do this by keeping third party code, such as <em>Seven5</em>, in this directory.  You need to make this directory &ldquo;look like&rdquo; a GOPATH directory by doing this:</p>

<pre><code>mkdir $GOPATH/bin
mkdir $GOPATH/src
mkdir $GOPATH/pkg
</code></pre>

<h2>0mq  : Networking library for talking to Mongrel2, if not already installed</h2>

<pre><code>git clone https://github.com/zeromq/zeromq2-1.git zeromq
cd zeromq
./autogen.sh
./configure
make
sudo make install
</code></pre>

<h2>mongrel2 : Web server of choice, if not already installled</h2>

<p>Mongrel2 is the web server of the gods&ndash;or at least of Zed Shaw.</p>

<pre><code>curl http://mongrel2.org/static/downloads/mongrel2-1.7.5.tar.bz2 &gt; mongrel2-1.7.5.tar.bz2
bunzip2 mongrel2-1.7.5.tar.bz2
tar -xvf mongrel2-1.7.5.tar
cd mongrel2-1.7.5
sudo make all install
</code></pre>

<h2>memcached, if not already installed</h2>

<p>Download the source from <a href="http://memcached.org/">memcached</a>.</p>

<pre><code>tar -xzvf memcached-1.4.10.tar.gz
cd memcached-1.4.10
./configure
sudo make install
</code></pre>

<h3>Optional: Black Friday for markdown compilation</h3>

<p>You only need this if you want to build the docs on your local machine.  The docs are included in the git wad-of-stuff on the branch &ldquo;gh-pages&rdquo;.</p>

<pre><code>git clone https://github.com/russross/blackfriday.git blackfriday
cd blackfriday
gomake install
</code></pre>

<p>Copy example/markdown into /usr/local/bin/ or some other place in your $PATH.</p>

<h2>Install needed go libraries</h2>

<p>When the &ldquo;go&rdquo; tool is fully finished, this step will not be needed.  For now, in a shell that has all the environment variables set as indicated above do this:</p>

<pre><code>cd $GOPATH
goinstall github.com/seven5/gozmq
goinstall launchpad.net/gocheck
goinstall github.com/bradfitz/gomemcache/memcache
goinstall github.com/mattn/go-sqlite3
goinstall github.com/seven5/mongrel2
goinstall github.com/petar/GoLLRB/llrb
</code></pre>

<p>You should be able to see all the source code for these packages in $GOPATH/src and you should be able to see the packages installed in $GOPATH/darwin-amd64/ (or whatever directory gets derived from your GOOS+GOARCH).</p>

<h2>Install Seven5 source</h2>

<p>We&rsquo;ll install <em>Seven5</em> &ldquo;the right way&rdquo; using the git and the go tool.  First get the source code and put in the right place in your GOPATH:</p>

<pre><code>cd $GOPATH/src
git clone git@github.com:seven5/seven5.git
go install seven5 seven5/store seven5/tune seven5/rock_on
</code></pre>

<h2>Test Seven5</h2>

<p>When you run tests or a <em>Seven5</em> application, you have to have a &ldquo;store&rdquo; running.  For now, that means memcached, as you installed earlier.  In a different shell, just run &ldquo;memcached&rdquo; and leave it running or, if you want to fancy &ldquo;memcached -vv&rdquo; so you can some feedback that <em>Seven5</em> is actually reading and writing to memcached.</p>

<p>Back in the shell from above where you have built <em>Seven5</em> try this:</p>

<pre><code>go test seven5 seven5/store
</code></pre>

<p>You should see the test results when this is done, something like this</p>

<pre><code>ok      seven5  1.042s
ok      seven5/store    0.143s
</code></pre>

<h2>Optional but handy software</h2>

<h3>TextMate bundle</h3>

<pre><code>curl -L github.com/downloads/AlanQuatermain/go-tmbundle/install-go-tmbundle.sh | sh
</code></pre>

<p>Edit TextMate&rsquo;s global PATH variable to include $GOBIN.</p>

</body>
</html>
