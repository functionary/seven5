<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Seven5: Install</title>
  <meta name="GENERATOR" content="Blackfriday Markdown Processor v1.1" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" type="text/css" href="css/base.css" />
</head>
<body>

<h1>Seven5: Install</h1>

<p><nav>
    <ul>
        <li><a href="index.html">Intro</a></li>
        <li><a href="install.html">Install</a></li>
        <li><a href="develop.html">Develop</a></li>
        <li><a href="pontificate.html">Pontificate</a></li>
    </ul>
</nav></p>

<p>Here are the commands which we run to install the <a href="https://github.com/seven5/seven5">Seven5 source</a> and prerequisites on our OS X boxen.</p>

<p>You may need to edit the paths or config options to reflect your environment, but we made notes where that is likely.</p>

<h2>Go</h2>

<p>If you lack a compiler or something else Go needs, consult the <a href="http://golang.org/doc/install.html">Go install page</a>.</p>

<pre><code>mkdir ~/Documents/Go/ # Anywhere which you own is fine
cd ~/Documents/Go/
hg clone https://go.googlecode.com/hg/ go
cd go
hg update weekly #gives you most recent weekly build of go
cd src
./all.bash
./sudo.bash
</code></pre>

<p>To update to a new weekly:</p>

<pre><code>cd ~/Documents/Go/go/
hg pull
hg update weekly
cd src
./all.bash
./sudo.bash
</code></pre>

<h2>Your shell</h2>

<p>Some variables need to be in your environment before you proceed, so add them to ~/.bash_profile:</p>

<pre><code>export GOROOT=~/Documents/Go/go   #directory where you installed go
export GOBIN=$GOROOT/bin
export GOOS=darwin  #or your os, like 'linux' or 'freebsd'
export GOARCH=amd64  #or your arch, like 'x86' for 32-bit or 'arm'
export PATH=$PATH:$GOBIN
</code></pre>

<h2>The build tool, gb</h2>

<pre><code>goinstall go-gb.googlecode.com/hg/gb
</code></pre>

<p>You&rsquo;ll want to make sure you have an up-to-date version of gb&ndash;we use some of the latest features of it below.</p>

<h2>The testing tool, gocheck</h2>

<pre><code>bzr branch lp:gocheck
cd gocheck
make install
</code></pre>

<h2>0mq</h2>

<pre><code>git clone https://github.com/zeromq/zeromq2-1.git zeromq
cd zeromq
./autogen.sh
./configure
make
sudo make install
</code></pre>

<h2>Gozmq</h2>

<pre><code>goinstall github.com/alecthomas/gozmq
</code></pre>

<p>There is a patch that we have been using on darwin/OS X.  It is probably not needed on 64 bit linux systems.</p>

<pre><code>From 6ea494980d21e10f555583519efe8344823dd609 Mon Sep 17 00:00:00 2001
From: Ian Smith &lt;iansmith@acm.org&gt;
Date: Tue, 22 Nov 2011 12:08:12 +0100
Subject: [PATCH] fix another sizeof bug on darwin

---
 zmq.go |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/zmq.go b/zmq.go
index a4225c2..be88f5c 100644
--- a/zmq.go
+++ b/zmq.go
@@ -238,7 +238,7 @@ func (s *zmqSocket) destroy() {
 // Set an int option on the socket.
 // int zmq_setsockopt (void *s, int option, const void *optval, size_t optvallen); 
 func (s *zmqSocket) SetSockOptInt(option IntSocketOption, value int) error {
-       if C.zmq_setsockopt(s.s, C.int(option), unsafe.Pointer(&amp;value), C.size_t(unsafe.Sizeof(&amp;value))) != 0 {
+       if C.zmq_setsockopt(s.s, C.int(option), unsafe.Pointer(&amp;value), C.size_t(unsafe.Sizeof(C.int(value)))) != 0 {
                return errno()
        }
        return nil
-- 
1.7.7.1
</code></pre>

<h2>mongrel2</h2>

<pre><code>curl http://mongrel2.org/static/downloads/mongrel2-1.7.5.tar.bz2 &gt; mongrel2-1.7.5.tar.bz2
bunzip2 mongrel2-1.7.5.tar.bz2
tar -xvf mongrel2-1.7.5.tar
cd mongrel2-1.7.5
sudo make all install
</code></pre>

<h2>libevent  &ndash;not needed yet but will be in the future&ndash;</h2>

<p>Download the libevent source from <a href="http://www.monkey.org/~provos/libevent/">libevent</a>.</p>

<pre><code>tar -xzvf libevent-2.0.16-stable.tar.gz
cd libevent-2.0.16-stable
./configure
sudo make install
</code></pre>

<h2>memcached &ndash;not needed yet but will be soon&ndash;</h2>

<p>Download the source from <a href="http://memcached.org/">memcached</a>.</p>

<pre><code>tar -xzvf memcached-1.4.10.tar.gz
cd memcached-1.4.10
./configure
sudo make install
</code></pre>

<h2>Seven5</h2>

<p>Check out some repos and branches containing the mongrel2 connector, the seven5 stack, the docs and the samples.</p>

<pre><code>mkdir seven5dev
cd seven5dev
git clone -b master https://github.com/seven5/mongrel2 mongrel2
git clone -b master https://github.com/seven5/seven5 seven5
git clone -b gh-pages https://github.com/seven5/seven5 doc
git clone -b samples https://github.com/seven5/seven5 samples
</code></pre>

<h2>Building Everything With gb</h2>

<pre><code>cd seven5dev
gb
</code></pre>

<h2>Optional but handy software</h2>

<h3>TextMate bundle</h3>

<pre><code>curl -L github.com/downloads/AlanQuatermain/go-tmbundle/install-go-tmbundle.sh | sh
</code></pre>

<p>Edit TextMate&rsquo;s global PATH variable to include $GOBIN.</p>

<h3>Black Friday for markdown compilation</h3>

<pre><code>git clone https://github.com/russross/blackfriday.git blackfriday
cd blackfriday
gomake install
</code></pre>

<p>Copy example/markdown into /usr/local/bin/ or some other place in your $PATH.</p>

<h1>Seven5: The Dev Loop</h1>

<p>The following assumes that you are going to be developing in <code>samples</code> which is actually part of the <em>seven5</em> system itself.  Since <em>seven5</em> is pretty raw right now, we are assuming you don&rsquo;t want to do a &ldquo;install and forget&rdquo;, since you are likely to hack at <em>seven5</em> as well as your application.</p>

<p>Verify that in the step above &ldquo;Building Everything With gb&rdquo; created two subdirectories of your <code>seven5dev</code> directory (created above in the &ldquo;Seven5&rdquo; step).   These two directories are <code>_obj</code> for packages and <code>bin</code> for commands.  In <code>_obj</code> for example should be <code>seven5.a</code> and others.  In bin are the seven5 tools, critically <code>rock_on</code> and <code>tune</code>.</p>

<p>You need to set your SEVEN5BIN to point to this directory of commands, like this:</p>

<pre><code>export SEVEN5BIN=/Users/foo/seven5dev/bin
</code></pre>

<p>This environment variable is <em>only</em> needed because we are not installing seven5 in <code>$GOBIN</code> as we are assuming it is a bit premature for that.  This environment variable tells <code>rock_on</code> to override your <code>$PATH</code> when looking for <code>tune</code>.  When seven5 is more mature, we&rsquo;ll install all the tools to <code>$GOBIN</code>.</p>

<h2>Building A Seven5 Application</h2>

<p>Go to the application directory for <code>better_chat</code></p>

<pre><code>cd seven5dev/samples/better_chat
</code></pre>

<p>and try to build with <code>gb</code>.  You should get an error like this:</p>

<pre><code>(in .) building pkg &quot;better_chat&quot;
index.html.go:3: can't find import: &quot;seven5/dsl&quot;
1 broken target
(in .) could not build &quot;better_chat&quot;
</code></pre>

<p>again, this is product of not installing the <em>seven5</em> packages in the standard place, <code>$GOROOT/pkg</code>.</p>

<p>To remedy this problem, you need to tell <code>gb</code> where to find the &ldquo;root&rdquo; of your build tree, in this case your <code>seven5dev</code> directory.  Create the file <code>gb.cfg</code> in the <code>better_chat</code> directory.  It needs only this line:</p>

<pre><code>workspace=../..
</code></pre>

<p>This will allow it to find all your seven5 libraries in <code>seven5dev/_obj</code>.</p>

<h3>Back to normal</h3>

<p>The normal way to do <em>seven5</em> development is to run <code>rock_on</code> in your application directory with the full name of the project&rsquo;s package as a parameter:</p>

<pre><code>cd seven5dev/samples/better_chat
$SEVEN5BIN/rock_on samples/better_chat
</code></pre>

<p>The parameter is needed because <code>rock_on</code> cannot determine if the project&rsquo;s name should be &ldquo;better_chat&rdquo; or &ldquo;samples/better_chat&rdquo;  or &ldquo;seven5/samples/better_chat&rdquo;, etc.  You should see output like this:</p>

<pre><code>Generated _seven5/better_chat.go
Running gb in workspace /Volumes/External/seven5dev
Cleaning seven5/dsl
Cleaning samples/better_chat
Cleaning mongrel2
Cleaning seven5
Cleaning samples/better_chat/_seven5
(in seven5/dsl) building pkg &quot;seven5/dsl&quot;
(in samples/better_chat) building pkg &quot;samples/better_chat&quot;
(in mongrel2) building pkg &quot;mongrel2&quot;
(in seven5) building pkg &quot;seven5&quot;
(in samples/better_chat/_seven5) building cmd &quot;better_chat&quot;
Built 10 targets
Seven5 is logging to mongrel2/log/seven5.log
Web app running
</code></pre>

<p>This means that your web application&rsquo;s &ldquo;main&rdquo; has been generated to <code>_seven5/better_chat.go</code> and the application compiled and linked with the necessary <em>seven5</em> libraries.  Plus, the web server mongrel2 has been run with your application connected to it.  Try this URL:</p>

<pre><code>http://localhost:6767/css/site.css
</code></pre>

<p>That is the CSS file that is generated as a result of the go-language DSL code in <code>site.css.go</code>.  Similarly:</p>

<pre><code>http://localhost:6767/index.html
</code></pre>

<p>is a result of <code>index.html.go</code></p>

<p><code>rock_on</code> should be left running in a shell window.  Go to another shell window and try this:</p>

<pre><code>cd seven5dev/samples/better_chat
touch index.html.go
</code></pre>

<p>You should see output like this in the window running <code>rock_on</code></p>

<pre><code>--------------------------------------
Project samples/better_chat changed
--------------------------------------
Generated _seven5/better_chat.go
Running gb in workspace /Volumes/External/seven5dev
Cleaning seven5/dsl
Cleaning samples/better_chat
Cleaning mongrel2
Cleaning seven5
Cleaning samples/better_chat/_seven5
(in seven5/dsl) building pkg &quot;seven5/dsl&quot;
(in samples/better_chat) building pkg &quot;samples/better_chat&quot;
(in mongrel2) building pkg &quot;mongrel2&quot;
(in seven5) building pkg &quot;seven5&quot;
(in samples/better_chat/_seven5) building cmd &quot;better_chat&quot;
Built 10 targets
Seven5 is logging to mongrel2/log/seven5.log
Web app running
</code></pre>

<p>This happens automatically as you change <code>.go</code> files in your project.  This does all the work to &ldquo;bring back up&rdquo; all your changes to the web server as well, so you can hit <code>Command-R</code> in your web browser to reload the pages with the changes.</p>

</body>
</html>
